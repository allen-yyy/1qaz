这里的大部分是c代码
